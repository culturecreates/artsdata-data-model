{% comment %}
  Automatic language switcher
  Detects if French version exists and provides toggle
{% endcomment %}

{% assign current_url = page.url %}
{% assign is_french = false %}

{% if current_url contains '.fr.html' or page.lang == 'fr' %}
  {% assign is_french = true %}
{% endif %}

{% if is_french %}
  {% if current_url == '/index.fr.html' or current_url == '/' %}
    {% assign alternate_url = '/' %}
  {% else %}
    {% assign alternate_url = current_url | replace: '.fr.html', '.html' %}
  {% endif %}
  {% assign alternate_lang = 'en' %}
  {% assign current_label = 'FR' %}
  {% assign alternate_label = 'EN' %}
{% else %}
  {% if current_url == '/' or current_url == '/index.html' %}
    {% assign alternate_url = '/index.fr.html' %}
  {% else %}
    {% assign alternate_url = current_url | replace: '.html', '.fr.html' %}
  {% endif %}
  {% assign alternate_lang = 'fr' %}
  {% assign current_label = 'EN' %}
  {% assign alternate_label = 'FR' %}
{% endif %}

{% comment %} Check if alternate exists {% endcomment %}
{% assign alternate_exists = false %}
{% for p in site.pages %}
  {% if p.url == alternate_url %}
    {% assign alternate_exists = true %}
    {% break %}
  {% endif %}
{% endfor %}

{% comment %} Check in collections if not found {% endcomment %}
{% unless alternate_exists %}
  {% for item in site.classes %}
    {% if item.url == alternate_url %}
      {% assign alternate_exists = true %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endunless %}

{% unless alternate_exists %}
  {% for item in site.architecture %}
    {% if item.url == alternate_url %}
      {% assign alternate_exists = true %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endunless %}

{% unless alternate_exists %}
  {% for item in site.gabarits-jsonld %}
    {% if item.url == alternate_url %}
      {% assign alternate_exists = true %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endunless %}

{% unless alternate_exists %}
  {% for item in site.identifiers-guidelines %}
    {% if item.url == alternate_url %}
      {% assign alternate_exists = true %}
      {% break %}
    {% endif %}
  {% endfor %}
{% endunless %}

<div class="language-switcher">
  {% if is_french %}
    {% comment %} Currently viewing French, so EN is alternate {% endcomment %}
    {% if alternate_exists %}
      <a href="{{ alternate_url | relative_url }}"
         class="btn-language-switch"
         hreflang="en">EN</a>
      <link rel="alternate" hreflang="en" href="{{ site.url }}{{ alternate_url }}" />
    {% else %}
      <span class="label-unavailable">EN unavailable</span>
    {% endif %}
    <span class="label-current-lang">FR</span>
  {% else %}
    {% comment %} Currently viewing English, so FR is alternate {% endcomment %}
    <span class="label-current-lang">EN</span>
    {% if alternate_exists %}
      <a href="{{ alternate_url | relative_url }}"
         class="btn-language-switch"
         hreflang="fr">FR</a>
      <link rel="alternate" hreflang="fr" href="{{ site.url }}{{ alternate_url }}" />
    {% else %}
      <span class="label-unavailable">FR unavailable</span>
    {% endif %}
  {% endif %}
</div>
